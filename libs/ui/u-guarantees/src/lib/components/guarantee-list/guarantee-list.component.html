<div class="row">
  <div class="col-6">
    <ivt-searchbar (valueChange)="updateSearchBarFilter($event)"></ivt-searchbar>
  </div>

  <div class="col-3 flex-start">
    <button mat-icon-button
            [ngClass]="{ 'bg-primary text-white': showFilters }"
            matTooltip="Filtrar"
            (click)="toggleFilter()">
      <mat-icon>filter_alt</mat-icon>
    </button>
    <!-- TODO: Uncomment in next release -->
    <!-- <button mat-icon-button
            matTooltip="Exportar a Excel"
            [loading]="loadingExcel"
            (click)="exportExcel.emit()">
      <mat-icon class="rotate-y-180">reply</mat-icon>
    </button> -->
  </div>

  <div class="col-3 flex-end pr-0">
    <button mat-raised-button
            [routerLink]="['new']"
            type="button"
            color="primary">
      Nueva garantía
    </button>
  </div>
</div>

<div [hidden]="!showFilters"
     class="row mb-4">
  <div class="col bg-light py-3 rounded d-flex">
    <ivt-date-filter class="mr-3"
                     label="Fecha"
                     [dateTypeOptions]="dateTypeOptions"
                     (filterItems)="updateDateFilter($event)">
    </ivt-date-filter>
    <ivt-radio-filter label="Estatus"
                      [options]="statusOptions"
                      (filterItems)="updateStatusFilter($event)">
    </ivt-radio-filter>
  </div>
</div>

<div *ngIf="selectedIds.hasValue()"
     class="row mt-4 bg-light py-3 rounded">
  <div class="col">
    <button mat-raised-button
            type="button"
            color="primary"
            (click)="createPaymentOrder.emit(selectedIds.selected)">
      Generar orden de pago
    </button>
  </div>
</div>

<ivt-empty-state *ngIf="!list.length"
                 message="No existen garantías que se cumplan con el criterio de búsqueda">
</ivt-empty-state>

<ng-container *ngIf="list.length">
  <ivt-table-header class="d-block mt-4"
                    [columns]="columns"
                    (sort)="updateSort($event)"></ivt-table-header>

  <ivt-virtual-scroll height="60vh"
                      [list]="list"
                      [ignoreNextBatch]="!hasMoreItems || loading"
                      (nextBatchEmitter)="getMoreItems.emit()">
    <ng-template let-item>
      <ivt-guarantee-row-container [item]="item"
                                   [isSelected]="selectedIds.isSelected(item.id)"
                                   (selectItem)="onSelectItem(item.id)">
      </ivt-guarantee-row-container>
    </ng-template>
  </ivt-virtual-scroll>
</ng-container>
