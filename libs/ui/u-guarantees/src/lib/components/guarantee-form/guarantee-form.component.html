<form [formGroup]="form"
      (ngSubmit)="submit()">
  <div nz-row
       [nzGutter]="[24, 8]">
    <div nz-col
         nzSpan="24">
      <ivt-go-back-title [title]="item?.id ? 'Editar Garantía' : 'Nueva Garantía'"></ivt-go-back-title>
    </div>
  </div>
  <div class="pt-3">
    <ivt-expansion-panel class="primary-panel mb-3 d-block"
                         title="Información General"
                         [isOpen]="true">
      <div nz-row
           [nzGutter]="[24, 8]">
        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Fecha inicio garantía">
            <input ivtInput
                   [matDatepicker]="startDate"
                   formControlName="startDate">
            <mat-datepicker-toggle matSuffix
                                   [for]="startDate"></mat-datepicker-toggle>
            <mat-datepicker #startDate></mat-datepicker>
          </ivt-form-field>
        </div>
        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Fin garantía por tiempo">
            <input ivtInput
                   [matDatepicker]="endDate"
                   formControlName="endDate">
            <mat-datepicker-toggle matSuffix
                                   [for]="endDate"></mat-datepicker-toggle>
            <mat-datepicker #endDate></mat-datepicker>
          </ivt-form-field>
        </div>
      </div>

      <div nz-row
           [nzGutter]="[24, 8]">
        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Compañía">
            <mat-select formControlName="companyId">
              <mat-option *ngFor="let option of companyOptions"
                          [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </ivt-form-field>
        </div>

        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Tipo de producto">
            <input ivtInput
                   ivtUppercase
                   formControlName="productType">
          </ivt-form-field>
        </div>
      </div>

      <div nz-row
           [nzGutter]="[24, 8]">
        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Kilometraje inicial">
            <input ivtInput
                   ivtUppercase
                   type="number"
                   formControlName="kilometrageStart">
          </ivt-form-field>
        </div>
        <div nz-col
             nzMd="24"
             nzLg="12">
          <ivt-form-field label="Fin garantía por kilometraje">
            <input ivtInput
                   ivtUppercase
                   type="number"
                   formControlName="kilometrageEnd">
          </ivt-form-field>
        </div>
      </div>

      <!-- TODO: Uncomment when products is ready
      <div nz-row [nzGutter]="[24, 8]">
        <div nz-col nzSpan="24">
          <ivt-form-field label-"Producto">
            <mat-select formControlName="productId">
              <mat-option *ngFor="let option of productOptions"
                          [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </ivt-form-field>
        </div>
      </div> -->
    </ivt-expansion-panel>

    <ivt-expansion-panel class="primary-panel mb-3 d-block"
                         title="Cliente"
                         [isOpen]="true">
      <form [formGroup]="client">
        <div nz-row
             [nzGutter]="[24, 8]">
          <div nz-col
               nzMd="24"
               nzLg="12">
            <div>
              <label>Tipo de persona:</label>
            </div>
            <mat-radio-group formControlName="personType">
              <mat-radio-button *ngFor="let option of personTypeOptions"
                                [value]="option.value"
                                class="mr-3">
                {{ option.label }}
              </mat-radio-button>
            </mat-radio-group>
          </div>
          <div nz-col
               nzMd="24"
               nzLg="12">
            <ivt-form-field label="Punto de Venta">
              <input ivtInput
                     ivtUppercase
                     formControlName="salesPlace">
            </ivt-form-field>
          </div>
        </div>

        <form [hidden]="!showPhysicalForm"
              [formGroup]="physicalInfoForm">
          <div nz-row
               [nzGutter]="[24, 8]">
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Nombre(s)">
                <input ivtInput
                       ivtUppercase
                       formControlName="name">
              </ivt-form-field>
            </div>
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Apellido Paterno">
                <input ivtInput
                       ivtUppercase
                       formControlName="lastName">
              </ivt-form-field>
            </div>
          </div>

          <div nz-row
               [nzGutter]="[24, 8]">
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Apellido Materno">
                <input ivtInput
                       ivtUppercase
                       formControlName="secondLastName">
              </ivt-form-field>
            </div>
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Fecha de nacimiento">
                <input ivtInput
                       [matDatepicker]="birthDatePicker"
                       formControlName="birthDate">
                <mat-datepicker-toggle matSuffix
                                       [for]="birthDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #birthDatePicker></mat-datepicker>
              </ivt-form-field>
            </div>
          </div>
        </form>

        <form [hidden]="!showMoralForm"
              [formGroup]="moralInfoForm">
          <div nz-row
               [nzGutter]="[24, 8]">
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Razón Social">
                <input ivtInput
                       ivtUppercase
                       formControlName="businessName">
              </ivt-form-field>
            </div>
            <div nz-col
                 nzMd="24"
                 nzLg="12">
              <ivt-form-field label="Fecha de constitución">
                <input ivtInput
                       [matDatepicker]="constitutionDatePicker"
                       formControlName="constitutionDate">
                <mat-datepicker-toggle matSuffix
                                       [for]="constitutionDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #constitutionDatePicker></mat-datepicker>
              </ivt-form-field>
            </div>
          </div>

          <div nz-row
               [nzGutter]="[24, 8]">
            <div nz-col>
              <ivt-form-field label="Asesor">
                <input ivtInput
                       ivtUppercase
                       formControlName="adviser">
              </ivt-form-field>
            </div>
          </div>
        </form>

        <div nz-row
             [nzGutter]="[24, 8]">
          <div nz-col
               nzMd="24"
               nzLg="8">
            <ivt-form-field label="RFC">
              <input ivtInput
                     ivtUppercase
                     formControlName="rfc">
            </ivt-form-field>
          </div>
          <div nz-col
               nzMd="24"
               nzLg="8">
            <ivt-form-field label="Teléfono">
              <input ivtInput
                     type="tel"
                     mask="(00) 0000 0000"
                     formControlName="phone">
            </ivt-form-field>
          </div>
          <div nz-col
               nzMd="24"
               nzLg="8">
            <ivt-form-field label="Correo">
              <input ivtInput
                     type="email"
                     formControlName="email">
            </ivt-form-field>
          </div>
        </div>
        <ivt-address-form [form]="addressForm"></ivt-address-form>
      </form>
    </ivt-expansion-panel>

    <ivt-expansion-panel class="primary-panel mb-3 d-block"
                         title="Vehículo"
                         [isOpen]="true">
      <div *ngIf="!isElegible"
           nz-row
           [nzGutter]="[24, 8]"
           class="my-3">
        <div nz-col
             nzSpan="24"
             class="bg-alert text-white py-3 rounded flex-start">
          <mat-icon class="mr-3">error</mat-icon>
          <span>Este vehículo no es elegible para garantizar.
            Consultar las revisiones del vehículo para confirmar.
          </span>
        </div>
      </div>
      <ivt-vehicle-form [form]="vehicleForm"
                        [companyId]="companyId$ | async"
                        (verifyVin)="verifyVin.emit($event)"></ivt-vehicle-form>
    </ivt-expansion-panel>
  </div>

  <div nz-row
       [nzGutter]="[24, 8]"
       class="mt-4 mb-3">
    <div nz-col
         nzSpan="24"
         class="px-0 flex-end">
      <button mat-raised-button
              class="mr-3"
              type="button"
              [routerLink]="['..']">
        Cancelar
      </button>
      <button mat-raised-button
              type="submit"
              color="primary"
              [loading]="loading"
              [disabled]="!isEditable && this.item || !isElegible">
        Guardar
      </button>
    </div>
  </div>
</form>
