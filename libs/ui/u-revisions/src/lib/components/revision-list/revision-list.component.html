<div *ngIf="title"
     nz-row>
  <div nz-col
       nzSpan="24">
    <nz-page-header nzBackIcon
                    [nzTitle]="title"
                    [routerLink]="['/spa/vehicles']">
    </nz-page-header>
  </div>
</div>

<div nz-row
     [nzGutter]="12"
     class="mb-3">
  <div nz-col
       nzXs="16"
       nzSm="20"
       nzMd="12">
    <ivt-searchbar (valueChange)="updateSearchBarFilter($event)"></ivt-searchbar>
  </div>
  <div nz-col
       nzFlex="auto"
       class="flex-end">
    <button *ngIf="title"
            nz-button
            [routerLink]="['new']"
            type="button"
            nzType="primary">
      Nueva revisión
    </button>
  </div>
</div>

<nz-divider></nz-divider>

<div nz-row
     [nzGutter]="12">
  <div nz-col
       nzFlex="auto"
       class="flex-end">
    {{ info?.pageStart }}-{{ info?.pageEnd }} de {{ info?.total }}
  </div>
</div>

<nz-divider></nz-divider>

<nz-table #table
          nzSize="small"
          [nzData]="list"
          [nzFrontPagination]="false"
          [nzTotal]="info?.total"
          [nzPageIndex]="info?.pageIndex"
          [nzLoading]="loading"
          (nzQueryParams)="filterItems.emit($event)">
  <thead>
    <tr nz-row>
      <th nzSortFn="true"
          nzColumnKey="revision.status"
          nz-col
          nzXs="7"
          nzMd="4"
          nzLg="2">Estatus</th>
      <th nzSortFn="true"
          nzColumnKey="vehicle.vin"
          nz-col
          nzXs="17"
          nzMd="8"
          nzLg="4">VIN</th>
      <th nzSortFn="true"
          nzColumnKey="vehicle.brand"
          nz-col
          nzXs="0"
          nzMd="6"
          nzLg="3">Marca</th>
      <th nzSortFn="true"
          nzColumnKey="vehicle.model"
          nz-col
          nzXs="0"
          nzLg="3">Modelo</th>
      <th nzSortFn="true"
          nzColumnKey="vehicle.year"
          nz-col
          nzXs="0"
          nzLg="2">Año</th>
      <th nzSortFn="true"
          nzColumnKey="revision.createdAt"
          nz-col
          nzXs="0"
          nzMd="6"
          nzLg="4">Fecha de revisión</th>
      <th nzSortFn="true"
          nzColumnKey="revision.observations"
          nz-col
          nzXs="0"
          nzLg="6">Observaciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of table.data"
        nz-row>
      <td nz-col
          nzXs="7"
          nzMd="4"
          nzLg="2">
        <nz-tag nz-tooltip
                nzTooltipPlacement="right"
                [nzTooltipTitle]="statusLabels[revisionStatus[item.status]] | empty"
                [nzColor]="colorMaps[revisionStatus[item.status]]">
          <i nz-icon
             [nzType]="iconMaps[revisionStatus[item.status]]"></i>
        </nz-tag>
      </td>
      <td nz-col
          nzXs="15"
          nzMd="8"
          nzLg="4">{{ item?.vehicle?.vin | empty }}</td>
      <td nz-col
          nzXs="0"
          nzMd="6"
          nzLg="3">{{ item?.vehicle?.brand | empty }}</td>
      <td nz-col
          nzXs="0"
          nzLg="3">{{ item?.vehicle?.model | empty }}</td>
      <td nz-col
          nzXs="0"
          nzLg="2">{{ item?.vehicle?.year | empty }}</td>
      <td nz-col
          nzXs="0"
          nzMd="4"
          nzLg="4">{{ item?.createdAt | date: 'dd/mm/yy' }}</td>
      <td nz-col
          nzXs="0"
          nzLg="5">{{ item?.observations | empty }}</td>
      <td nz-col
          nzXs="2"
          nzMd="2"
          nzLg="1">
        <button nz-button
                nz-dropdown
                [nzDropdownMenu]="menu"
                nzType="text"
                nz-tooltip
                nzTooltipTitle="Acciones"
                nzTrigger="click">
          <i nz-icon
             nzType="more"
             nzTheme="outline"></i>
        </button>
      </td>
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item
              nz-tooltip
              [nzTooltipTitle]="!isEditable(item) ? 'La revisión no se puede editar porque ya pasaron más de tres meses' : ''"
              [routerLink]="isEditable(item) ? [item.id] : null"
              [nzDisabled]="!isEditable(item)">
            Editar revisión
          </li>

          <li nz-menu-item
              nz-tooltip
              [nzTooltipTitle]="!isEditable(item) ? 'La revisión no se puede eliminar porque ya pasaron más de tres meses' : ''"
              [nzDisabled]="!isEditable(item)"
              (click)="isEditable(item) && delete.emit(item)">
            Eliminar revisión
          </li>
        </ul>
      </nz-dropdown-menu>
    </tr>
  </tbody>
</nz-table>
